(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e4efda7"],{"4c7c":function(e,t,a){"use strict";var o=a("a1c4"),r=a.n(o);r.a},"7a5c":function(e,t,a){},a1c4:function(e,t,a){},b687:function(e,t,a){"use strict";var o=a("7a5c"),r=a.n(o);r.a},c67d:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{attrs:{type:"border-card",value:e.formData.common},on:{"tab-click":e.clickTab}},e._l(e.suppliers,function(t){return a("el-tab-pane",{key:t.common,attrs:{label:t.common,name:t.common}},[a("el-form",{ref:"form",refInFor:!0,attrs:{"label-width":"200px",rules:e.rules,model:e.formData,"status-icon":""}},[a("el-form-item",{attrs:{label:"机房",prop:"region",required:""}},[a("radio-button",{attrs:{options:e.regionOptions},model:{value:e.formData.region,callback:function(t){e.$set(e.formData,"region",t)},expression:"formData.region"}}),a("el-table",{attrs:{data:e.formData.region.zone}},[a("el-table-column",{attrs:{label:"可用区",prop:"common"}}),a("el-table-column",{attrs:{label:"机器数量",prop:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{min:0,precision:0,"controls-position":"right"},model:{value:t.row.amount,callback:function(a){e.$set(t.row,"amount",a)},expression:"scope.row.amount"}})]}}],null,!0)})],1)],1),a("el-form-item",{attrs:{label:"机型",prop:"modelType",required:""}},[a("radio-button",{attrs:{value:e.formData.modelType,options:e.modelOptions},on:{change:e.handleModelTypeChange}}),a("el-table",{ref:"multipleTable",refInFor:!0,attrs:{data:e.currentFormModel,"highlight-current-row":""},on:{"current-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:"操作",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{model:{value:t.row.checked,callback:function(a){e.$set(t.row,"checked",a)},expression:"scope.row.checked"}})]}}],null,!0)}),a("el-table-column",{attrs:{label:"CPU",prop:"cpu"}}),a("el-table-column",{attrs:{label:"内存",prop:"memory"}}),a("el-table-column",{attrs:{label:"可用区",prop:"zone"}}),a("el-table-column",{attrs:{label:"价格",prop:"price"}}),a("el-table-column",{attrs:{label:"交付周期"}},[e._v("0天")])],1)],1),a("el-form-item",{attrs:{label:"镜像"}},[a("el-col",{staticClass:"col"},[a("el-form-item",[a("el-select",{attrs:{placeholder:"选择镜像"},model:{value:e.formData.images,callback:function(t){e.$set(e.formData,"images",t)},expression:"formData.images"}},e._l(e.formData.region.images,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.image_id}})}),1)],1)],1)],1),a("el-form-item",{attrs:{label:"网络信息"}},[a("el-col",{staticClass:"col"},[a("el-form-item",[a("el-select",{staticStyle:{width:"400px","margin-right":"20px"},attrs:{placeholder:"选择网络",filterable:""},model:{value:e.formData.vswitch,callback:function(t){e.$set(e.formData,"vswitch",t)},expression:"formData.vswitch"}},e._l(e.formData.region.vswitch,function(e){return a("el-option",{key:e.id,attrs:{label:e.common,value:e.vswitch_id}})}),1)],1)],1)],1),a("el-form-item",{attrs:{label:"安全组"}},[a("el-col",{staticClass:"col"},[a("el-form-item",[a("el-select",{attrs:{placeholder:"选择安全组"},model:{value:e.formData.sgroups,callback:function(t){e.$set(e.formData,"sgroups",t)},expression:"formData.sgroups"}},e._l(e.formData.region.sgroups,function(e){return a("el-option",{key:e.id,attrs:{label:e.common,value:e.sgroup_id}})}),1)],1)],1)],1),a("el-form-item",{attrs:{label:"付费方式"}},[a("el-col",{staticClass:"col"},[a("el-form-item",[a("el-select",{attrs:{placeholder:"选择付费方式"},model:{value:e.formData.chargeType,callback:function(t){e.$set(e.formData,"chargeType",t)},expression:"formData.chargeType"}},e._l(e.chargeTypes,function(e){return a("el-option",{key:e.id,attrs:{label:e.common,value:e.name}})}),1)],1)],1)],1),a("el-form-item",{attrs:{label:"主机名",required:"",prop:"hostname"}},[a("el-input",{model:{value:e.formData.hostname,callback:function(t){e.$set(e.formData,"hostname",t)},expression:"formData.hostname"}})],1),a("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"系统盘"}},[a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"systemDisk.id"}},[a("el-select",{attrs:{value:e.formData.systemDisk.id,placeholder:"选择磁盘类型"},on:{change:e.changeSystemDisk}},e._l(e.currentSupplier.systemDisk,function(e){return a("el-option",{key:e.id,attrs:{label:e.common,value:e.id}})}),1)],1)],1),a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"systemDisk.size"}},[a("div",[a("el-input-number",{attrs:{value:e.formData.systemDisk.size,placeholder:"磁盘容量",min:240,max:2e3,precision:0,"controls-position":"right"},on:{change:e.changeSystemDiskSize}}),e._v("\n                (GB)\n              ")],1)])],1)],1),a("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"数据盘"}},[a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"disk.id"}},[a("el-select",{attrs:{value:e.formData.disk.id,placeholder:"选择磁盘类型"},on:{change:e.changeDisk}},e._l(e.currentSupplier.disk,function(e){return a("el-option",{key:e.id,attrs:{label:e.common,value:e.id}})}),1)],1)],1),a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"disk.size"}},[a("div",[a("el-input-number",{attrs:{value:e.formData.disk.size,placeholder:"磁盘容量",min:20,max:2e3,precision:0,"controls-position":"right"},on:{change:e.changeDiskSize}}),e._v("\n                (GB)\n              ")],1)])],1),a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"disk.amount"}},[a("el-input-number",{attrs:{placeholder:"磁盘数量",value:e.formData.disk.amount,min:1,max:20,precision:0,"controls-position":"right"},on:{change:e.changeDiskAmount}})],1)],1)],1),a("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"产品线",required:""}},[a("el-col",{staticClass:"col"},[a("el-form-item",{attrs:{prop:"business"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"产品线"},on:{change:e.getChangePdl},model:{value:e.formData.business,callback:function(t){e.$set(e.formData,"business",t)},expression:"formData.business"}},e._l(e.pdls,function(e){return a("el-option",{key:e.business,attrs:{value:e,label:e.business}})}),1)],1)],1)],1),a("el-form-item",{staticStyle:{"text-align":"left"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v("创建")])],1)],1)],1)}),1),a("el-dialog",{attrs:{title:"机器详情",visible:e.createVisible,width:"80%"},on:{"update:visible":function(t){e.createVisible=t}}},[a("el-table",{attrs:{data:e.orderData,border:""}},[a("el-table-column",{attrs:{label:"主机名",prop:"hostname"}}),a("el-table-column",{attrs:{label:"cpu",prop:"model.cpu"}}),a("el-table-column",{attrs:{label:"内存",prop:"model.memory"}}),a("el-table-column",{attrs:{label:"可用区",prop:"model.zone"}}),a("el-table-column",{attrs:{label:"套餐",prop:"model.InstanceType"}}),a("el-table-column",{attrs:{label:"数量",prop:"region.zone[0].amount"}}),a("el-table-column",{attrs:{label:"产品线",prop:"business"}}),a("el-table-column",{attrs:{label:"付费方式",prop:"chargeType"}}),a("el-table-column",{attrs:{label:"供应商",prop:"name"}}),a("el-table-column",{attrs:{label:"提交人",prop:"proposer"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("创建")])],1)],1)],1)},r=[],i=(a("96cf"),a("3b8d")),n=a("cebc"),s=(a("20d6"),a("7514"),a("7f7f"),a("ac6a"),a("456d"),a("2f62")),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ul",{staticClass:"container"},e._l(e.options,function(t){return a("li",{key:t.label,staticClass:"item"},[a("el-tag",{attrs:{size:"small",type:e.value===t.value?"":"info"},on:{click:function(a){return e.handleClick(t.value)}}},[e._v("\n        "+e._s(t.label)+"\n      ")])],1)}),0),a("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"input"})],1)},c=[],m=(a("c5f6"),a("ed08")),u={name:"RadioButton",mixins:[m["a"]],props:{value:[String,Number,Array,Object],options:[Array]},methods:{handleClick:function(e){e!==this.$props.value&&(this.$emit("change",e),this.$emit("input",e),this.$xcDispatch("ElFormItem","el.form.change",e))}}},p=u,f=(a("b687"),a("2877")),d=Object(f["a"])(p,l,c,!1,null,"2cd49dea",null),h=d.exports,b={name:"atlas",components:{RadioButton:h},data:function(){return{formData:{common:void 0,systemDisk:{},disk:{},id:void 0,model:void 0,name:void 0,region:{},vswitch:void 0,sgroups:void 0,business:void 0,tag_id:void 0,approver:void 0,hostname:void 0,chargeType:""},createVisible:!1,modelT:[],orderData:[],checked:!0,choiseVisible:!1,dataDisk:"",chargeTypes:[{id:2,name:"PostPaid",common:"按量付费"},{id:1,name:"PrePaid",common:"包年包月"}],DiskTypes:[{id:1,category:"cloud_efficiency",common:"高效云盘"},{id:2,category:"cloud_ssd",common:"SSD云盘"}],rules:{region:{validator:function(e,t,a){return 0===Object.keys(t).length?a("请选择机房"):a()}},sgroup:{validator:function(e,t,a){return 0===Object.keys(t).length?a("请选安全组"):a()}},vswitch:{validator:function(e,t,a){return 0===Object.keys(t).length?a("请选择网络"):a()}},"systemDisk.id":{validator:function(e,t,a){t?a():a("请选择磁盘类型")}},"systemDisk.size":{validator:function(e,t,a){t?a():a("请选择磁盘容量")}},"systemDisk.amount":{validator:function(e,t,a){t?a():a("请输入磁盘数量")}},business:{required:!0,message:"请输入产品线"},approver:{required:!0,message:"请选择审批人"}}}},computed:{pathName:function(){return this.$route.name},suppliers:function(){return this.$store.state.suppliers},approvers:function(){return this.$store.state.approvers},pdls:function(){return this.$store.state.pdls},currentSupplier:function(){var e=this;return this.suppliers.find(function(t){return t.common===e.formData.common})||{}},currentSupplierIndex:function(){var e=this;return this.suppliers.findIndex(function(t){return t.common===e.formData.common})},modelOptions:function(){var e=this.formData.region,t=e&&e.modelType||[];return t.map(function(e){return{label:e.name,value:e.id}})},currentFormModel:function(){var e=this.formData.modelType;if("undefined"===typeof e)return[];var t=(this.formData.region.modelType||[]).find(function(t){return t.id===e});return t?(t.model.forEach(function(e){e.checked=!1}),t.model||[]):[]},regionOptions:function(){var e=this.currentSupplier;return console.log("region:",e.region),(e.region||[]).map(function(e){return{label:e.common,value:e}})},vswitchOptions:function(){var e=this.formData.region,t=e&&e.vswitch||[];return t.map(function(e){return{label:e.common,value:e}})},imagesOptions:function(){var e=this.formData.region,t=e&&e.images||[];return t.map(function(e){return{label:e.name,value:e}})},groupOptions:function(){var e=this.formData.region,t=e&&e.sgroups||[];return t.map(function(e){return{label:e.common,value:e.sgroup_id}})}},watch:{suppliers:function(e){if(e.length>0&&void 0===this.formData.common){var t=e[0];this.changeSupplier(t.common)}},"formData.region":function(e,t){e.id!==t.id&&(this.formData.modelType=void 0)}},methods:Object(n["a"])({},Object(s["b"])(["getSuppliers","purchase","doOrder"]),{getData:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.formData={common:void 0,systemDisk:{},disk:{},id:void 0,model:void 0,name:void 0,region:{},vswitch:void 0,sgroups:void 0,business:void 0,tag_id:void 0,approver:void 0,hostname:void 0,chargeType:""};case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleSelectionChange:function(e){var t=this.currentFormModel;t.forEach(function(t){t.id!==e.id?t.checked=!1:t.checked=!0}),this.formData.model=e},clickTab:function(e){this.changeSupplier(e.name)},handleModelTypeChange:function(e){this.formData=Object(n["a"])({},this.formData,{modelType:e})},getChangePdl:function(e){this.formData.tag_id=e.tag_id,this.formData.business=e.business},changeSupplier:function(e){var t=this.suppliers.find(function(t){return t.common===e})||{};this.formData={common:t.common,disk:{},systemDisk:{},id:t.id,name:t.name,region:{},vswitch:void 0,business:void 0,approver:void 0}},changeDisk:function(e){var t=this.currentSupplier.disk.find(function(t){return t.id===e});this.formData.disk=Object(n["a"])({},this.formData.disk,t)},changeSystemDisk:function(e){var t=this.currentSupplier.systemDisk.find(function(t){return t.id===e});this.formData.systemDisk=Object(n["a"])({},this.formData.systemDisk,t)},changeSystemDiskSize:function(e){this.formData.systemDisk=Object(n["a"])({},this.formData.systemDisk,{size:String(e)})},changeSystemDiskAmount:function(e){this.formData.systemDisk=Object(n["a"])({},this.formData.systemDisk,{amount:e})},changeDiskSize:function(e){this.formData.disk=Object(n["a"])({},this.formData.disk,{size:String(e)})},changeDiskAmount:function(e){this.formData.disk=Object(n["a"])({},this.formData.disk,{amount:e})},handleCreate:function(){var e=this.formData,t=(e.region.zone||[]).filter(function(e){return e.amount>0});this.orderData=[Object(n["a"])({},e,{disk:[e.disk],systemDisk:[e.systemDisk],zone:t,vswitch:[e.vswitch],proposer:this.$store.state.user.username})],this.createVisible=!0},submitForm:function(){var e=this;this.$refs.form[this.currentSupplierIndex].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(a){var o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:return o=e.formData,(o.region.zone||[]).filter(function(e){return e.amount>0}),e.formData.systemDisk.category+" * "+e.formData.systemDisk.size,"{}"!=JSON.stringify(e.formData.disk)&&(e.dataDisk=e.formData.disk.category+" * "+e.formData.disk.size+" * "+e.formData.disk.amount),t.next=8,e.doOrder({region:e.formData.region.region_id,zone:e.formData.region.zone[0].zone_id,amount:e.formData.region.zone[0].amount,hostname:e.formData.hostname,model:e.formData.model.cpu+" * "+e.formData.model.memory,chargeType:e.formData.chargeType,instanceType:o.model.InstanceType,vswitch:e.formData.vswitch,image:e.formData.images,sgroup:e.formData.sgroups,supplier_id:e.formData.name,business:e.formData.business,systemDiskCategory:e.formData.systemDisk.category,systemDiskSize:e.formData.systemDisk.size,dataDiskCategory:e.formData.disk.category,diskSize:e.formData.disk.size,diskAmount:e.formData.disk.amount,proposer:e.$store.state.user.username,tag_id:e.formData.tag_id,cpu:e.formData.model.cpu});case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),this.createVisible=!1,this.$router.push("/tree")}}),created:function(){this.getSuppliers()}},g=b,D=(a("4c7c"),Object(f["a"])(g,o,r,!1,null,"7ef5153a",null));t["default"]=D.exports}}]);