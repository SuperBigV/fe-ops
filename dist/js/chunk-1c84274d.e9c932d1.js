(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c84274d"],{"031f":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:4}},[e._v("\r\n          服务树\r\n         "),i("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"SlotMenuList",attrs:{data:e.tableTree,props:e.defaultProps,"node-key":"id","filter-node-method":e.filterNode,"default-expanded-keys":[1],"default-checked-keys":[1],"current-node-key":1,accordion:""},on:{"node-contextmenu":e.rihgtClick,"node-click":e.getAssets}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}]},[i("el-menu",{staticClass:"el-menu-vertical",attrs:{id:"rightClickMenu","active-text-color":"#fff","text-color":"#fff"},on:{select:e.handleRightSelect}},[i("el-menu-item",{staticClass:"menuItem",attrs:{index:"1"}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v("添加节点")])]),i("el-menu-item",{staticClass:"menuItem",attrs:{index:"2"}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v("修改节点")])]),i("el-menu-item",{staticClass:"menuItem",attrs:{index:"3"}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v("删除节点")])])],1)],1)],1),i("el-col",{attrs:{span:20}},[i("div",{staticClass:"container"},[i("el-row",[i("el-col",{attrs:{span:8}},[i("div",[e._v(" \r\n               当前节点："),i("el-input",{staticClass:"handle-input",attrs:{disabled:!0},model:{value:e.cur_tag,callback:function(t){e.cur_tag=t},expression:"cur_tag"}})],1)]),i("el-col",{attrs:{span:4}},[i("div",[i("el-badge",{staticClass:"item",attrs:{value:e.data.counts}},[i("el-button",{attrs:{size:"small"}},[e._v("主机数量")])],1)],1)]),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"handle-box"},[i("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"主机名或ip"},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("搜索")]),i("el-button",{attrs:{type:"success",round:""},on:{click:e.hostBind}},[e._v("主机绑定")])],1)])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table",attrs:{data:e.data.hostTable,border:""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),i("el-table-column",{attrs:{type:"index",label:"id",width:"50"}}),i("el-table-column",{attrs:{prop:"hostname",label:"主机名",width:"150",align:"center"}}),i("el-table-column",{attrs:{align:"center",label:"ip",prop:"bip",width:"150"}}),i("el-table-column",{attrs:{prop:"tag",label:"产品线",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.tag,function(t){return i("div",{key:t},[e._v("\r\n                           "+e._s(t)+" \r\n                        ")])})}}])}),i("el-table-column",{attrs:{label:"操作",width:"220",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",icon:"el-icon-refresh-right"},on:{click:function(i){return e.handleReboot(t.$index,t.row)}}},[e._v("重启")]),i("el-button",{staticClass:"cadetblue",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleRename(t.$index,t.row)}}},[e._v("改名")]),i("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.$index,t.row)}}},[e._v("下线")])]}}])})],1),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-count":e.page_count,"page-size":e.page_size,"current-page":e.cur_page},on:{"current-change":e.handleCurrentChange}})],1)],1)])],1),i("el-dialog",{attrs:{title:"主机绑定",visible:e.bindVisible,width:"30%"},on:{"update:visible":function(t){e.bindVisible=t}}},[i("el-form",{ref:"NODE",attrs:{model:e.NODE,"label-width":"90px"}},[i("el-form-item",{attrs:{label:"产品线"}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择节点"},on:{change:e.getChangedNode},model:{value:e.n_value,callback:function(t){e.n_value=t},expression:"n_value"}},e._l(e.nodes,function(e){return i("el-option",{key:e.tag_id,attrs:{label:e.business,value:e}})}),1)],1),i("el-form-item",{attrs:{label:"主机"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.bindHosts,callback:function(t){e.bindHosts=t},expression:"bindHosts"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"success",round:""},on:{click:e.bind}},[e._v("绑定")]),i("el-button",{attrs:{type:"danger",round:""},on:{click:e.unbind}},[e._v("解绑")]),i("el-button",{on:{click:function(t){e.bindVisible=!1}}},[e._v("取 消")])],1)],1),i("el-dialog",{attrs:{title:"新增节点",visible:e.addVisible,width:"30%"},on:{"update:visible":function(t){e.addVisible=t}}},[i("el-form",{ref:"NODE",attrs:{model:e.NODE,"label-width":"90px"}},[i("el-form-item",{attrs:{label:"节点名称"}},[i("el-input",{model:{value:e.NODE.name,callback:function(t){e.$set(e.NODE,"name",t)},expression:"NODE.name"}})],1),i("el-form-item",{attrs:{label:"节点别名"}},[i("el-input",{model:{value:e.NODE.cname,callback:function(t){e.$set(e.NODE,"cname",t)},expression:"NODE.cname"}})],1),i("el-form-item",{attrs:{label:"节点类型"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.NODE.node_type,callback:function(t){e.$set(e.NODE,"node_type",t)},expression:"NODE.node_type"}})],1),i("el-form-item",{attrs:{label:"节点负责人"}},[i("el-input",{on:{input:e.updateOwner},model:{value:e.NODE.info.owner,callback:function(t){e.$set(e.NODE.info,"owner",t)},expression:"NODE.info.owner"}})],1),i("el-form-item",{attrs:{label:"联系人邮箱"}},[i("el-input",{model:{value:e.NODE.info.mail,callback:function(t){e.$set(e.NODE.info,"mail",t)},expression:"NODE.info.mail"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.addVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveAdd}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"编辑节点",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[i("el-form",{ref:"NODE",attrs:{model:e.NODE,"label-width":"90px"}},[i("el-form-item",{attrs:{label:"节点名称"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.NODE.name,callback:function(t){e.$set(e.NODE,"name",t)},expression:"NODE.name"}})],1),i("el-form-item",{attrs:{label:"节点别名"}},[i("el-input",{model:{value:e.NODE.cname,callback:function(t){e.$set(e.NODE,"cname",t)},expression:"NODE.cname"}})],1),i("el-form-item",{attrs:{label:"节点类型"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.NODE.node_type,callback:function(t){e.$set(e.NODE,"node_type",t)},expression:"NODE.node_type"}})],1),i("el-form-item",{attrs:{label:"节点负责人"}},[i("el-input",{model:{value:e.NODE.info.owner,callback:function(t){e.$set(e.NODE.info,"owner",t)},expression:"NODE.info.owner"}})],1),i("el-form-item",{attrs:{label:"联系人邮箱"}},[i("el-input",{model:{value:e.NODE.info.mail,callback:function(t){e.$set(e.NODE.info,"mail",t)},expression:"NODE.info.mail"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"主机重启",visible:e.rebootVisible,width:"300px",center:""},on:{"update:visible":function(t){e.rebootVisible=t}}},[i("div",{staticClass:"del-dialog-cnt"},[e._v("是否确定重启？")]),i("el-input",{attrs:{type:"textarea",rows:2,placeholder:"主机"},model:{value:e.hosts,callback:function(t){e.hosts=t},expression:"hosts"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.rebootVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.rebootHost}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"修改主机名",visible:e.renameVisible,width:"500px",center:""},on:{"update:visible":function(t){e.renameVisible=t}}},[i("el-form",{ref:"name",attrs:{"label-width":"90px"}},[i("el-form-item",{attrs:{label:"主机名:"}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.old_name,callback:function(t){e.old_name=t},expression:"old_name"}})],1),i("el-form-item",{attrs:{label:"新主机名:"}},[i("el-input",{attrs:{placeholder:"请输入新主机名",clearable:""},model:{value:e.new_name,callback:function(t){e.new_name=t},expression:"new_name"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.renameVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.renameHost}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"主机下线",visible:e.delVisible,width:"300px",center:""},on:{"update:visible":function(t){e.delVisible=t}}},[i("div",{staticClass:"del-dialog-cnt"},[e._v("下线不可恢复，是否确定下线？")]),i("el-input",{attrs:{type:"textarea",rows:2,placeholder:"主机"},model:{value:e.hosts,callback:function(t){e.hosts=t},expression:"hosts"}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.offlineHost}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"提示",visible:e.delNodeVisible,width:"300px",center:""},on:{"update:visible":function(t){e.delNodeVisible=t}}},[i("div",{staticClass:"del-dialog-cnt"},[e._v("删除不可恢复，是否确定删除？")]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.delNodeVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.NodeDel}},[e._v("确 定")])],1)])],1)},s=[],l=(i("7f7f"),i("96cf"),i("3b8d")),o=i("cebc"),a=i("2f62"),r=(i("1c46"),{data:function(){return{url:"./vuetable.json",tableTree:[],counts:"",menuVisible:!1,DATA:null,VALUE:null,bindHosts:"",NODE:{name:"",cname:"",node_type:"",pid:0,info:{mail:"",owner:""}},defaultProps:{children:"children",label:"name"},nodes:[],cur_tag:"cop.xiaochuan",hostTable:[],cur_page:1,page_size:10,page_count:1,multipleSelection:[],select_cate:"",select_word:"",del_list:[],is_search:!1,addVisible:!1,editVisible:!1,delVisible:!1,delNodeVisible:!1,rebootVisible:!1,renameVisible:!1,infoVisible:!1,bindVisible:!1,old_name:"",new_name:"",idx:-1,loading:!1,value:"",n_value:"",hosts:void 0,bind_form:{node_id:"",host_ids:[]}}},created:function(){this.getData()},computed:{data:function(){return{hostTable:this.$store.state.nodeassets.data,counts:this.$store.state.nodeassets.total,page_total:parseInt((this.$store.state.nodeassets.total+this.page_size-1)/this.page_size),cur_tag:(this.$store.state.node_path,this.cur_tag=this.$store.state.node_path)}}},methods:Object(o["a"])({},Object(a["b"])(["getUserPrivTags","getNodeAssets","getNodePath","getTempInstances","getNextNodeType","addTreeNode","deleteNode","globalSearch","getNodes","bind_hosts","unbind_hosts","reboot","offline","rename"]),{filterNode:function(e,t){return console.log("value:",e),console.log("data:",t),!e||-1!==t.label.indexOf(e)},handleCurrentChange:function(e){this.cur_page=e,this.getTreeHost()},getTreeHost:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getNodeAssets(1);case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getData:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.getUserPrivTags();case 4:return e.next=6,this.getNodes();case 6:return e.next=8,this.getTempInstances(this.cur_page,this.page_size);case 8:return e.next=10,this.getNodeAssets(1);case 10:return e.next=12,this.getNodePath(1);case 12:this.tableTree=this.$store.state.tree.data,this.nodes=this.$store.state.nodes;case 14:return e.prev=14,this.loading=!1,e.finish(14);case 17:case"end":return e.stop()}},e,this,[[1,,14,17]])}));function t(){return e.apply(this,arguments)}return t}(),global_search:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.globalSearch(t);case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),updateOwner:function(e){this.NODE.info.mail=e.concat("2014@xiaochuankeji.cn")},search:function(){this.global_search(this.select_word)},formatter:function(e,t){return e.status},filterTag:function(e,t){return t.tag===e},handlerUserAdd:function(){this.addVisible=!0},handleReboot:function(e,t){console.log("index:",e),console.log("row:",t),this.hosts||(this.hosts=t["hostname"],this.multipleSelection=t),this.rebootVisible=!0},handleDelete:function(e,t){this.idx=e,console.log(">>>row:",t),this.delVisible=!0},handleRename:function(e,t){this.old_name=t["hostname"],this.multipleSelection=t,console.log("row:",t),this.renameVisible=!0},saveEdit:function(){this.form.password=this.tableData[this.idx].password,this.form.public_key=this.tableData[this.idx].public_key,this.$set(this.tableData,this.idx,this.form),this.updateUser(this.tableData[this.idx])},saveAdd:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.VALUE.level>=4)){e.next=3;break}return this.$message.error("最多只支持四级！"),e.abrupt("return",!1);case 3:return e.next=5,this.addTreeNode(this.NODE);case 5:this.addVisible=!1,this.NODE={name:"",cname:"",node_type:"",pid:0,info:{mail:"",owner:""}},this.getData();case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),NodeDel:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.deleteNode(this.DATA.id);case 2:this.delNodeVisible=!1,this.getData();case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),rebootHost:function(){console.log("Host:",this.multipleSelection),this.reboot(this.multipleSelection),this.rebootVisible=!1},renameHost:function(){console.log("new_name:",this.new_name),this.multipleSelection["newname"]=this.new_name,this.rename(this.multipleSelection),this.renameVisible=!1},offlineHost:function(){console.log("offlineHosts:",this.multipleSelection),this.offline(this.multipleSelection),this.delVisible=!1},getAssets:function(e,t,i){this.getNodeAssets(e.id),this.getNodePath(e.id)},handleRightSelect:function(e){console.log(e),1==e?(this.menuVisible=!1,this.addVisible=!0):2==e?(this.NODE.name=this.DATA.name,this.NODE.cname=this.DATA.cname,this.NODE.info.owner=this.DATA.info.owner,this.NODE.info.mail=this.DATA.info.mail,this.NODE.node_type=this.DATA.node_type,this.editVisible=!0):3==e?(this.delNodeVisible=!0,this.getData()):4==e&&(console.log("4"),this.menuVisible=!1)},handleRightSelect1:function(e){console.log(e),1==e?this.menuVisible2=!1:2==e?(this.NodeEdit(this.NODE,this.DATA),this.menuVisible2=!1):3==e?(this.NodeDel(),this.menuVisible2=!1):4==e&&console.log("4")},getChangedNode:function(e){this.n_value=e.business,this.bind_form.node_id=e.tag_id},hostBind:function(){this.bind_form.host_ids=[],this.bind_form.node_id="";for(var e=[],t=0;t<this.multipleSelection.length;t++)e.push(this.multipleSelection[t].hostname);console.log("hosts:",e),console.log("tag:"),this.bindHosts=e.join("\n"),this.bindVisible=!0},bind:function(){for(var e=0;e<this.multipleSelection.length;e++)this.bind_form.host_ids.push(this.multipleSelection[e].id);console.log("bind_hsots:",this.bind_form),this.bind_hosts(this.bind_form),this.bindVisible=!1,this.getData()},unbind:function(){for(var e=0;e<this.multipleSelection.length;e++)this.bind_form.host_ids.push(this.multipleSelection[e].id);console.log("bind_hsots:",this.bind_form),this.unbind_hosts(this.bind_form),this.bindVisible=!1,this.getData()},handleSelectionChange:function(e){this.multipleSelection=e;for(var t=[],i=0;i<this.multipleSelection.length;i++)t.push(e[i].hostname);this.hosts=t.join("\n"),console.log("seclection:",this.multipleSelection)},getNextNT:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getNextNodeType(t);case 2:this.NODE.node_type=this.$store.state.node_type.data;case 3:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),rihgtClick:function(e,t,i,n){var s=this;this.objectID!==t.id?(this.NODE.pid=t.id,this.getNextNT(t.node_type),this.menuVisible=!0,this.DATA=t,this.VALUE=i):this.menuVisible=!this.menuVisible,document.addEventListener("click",function(e){s.menuVisible=!1});var l=document.querySelector("#rightClickMenu");l.style.left=e.clientX,l.style.top=e.clientY,l.style.position="absolute",l.style.width="130px",console.log("右键被点击的左侧:",l.style.left),console.log("右键被点击的顶部:",l.style.top),console.log("右键被点击的object:",t),console.log("右键被点击的value:",i)},rihgtClick2:function(e,t,i,n){var s=this;this.objectID2!==t.id?(this.objectID2=t.id,this.menuVisible2=!0,this.DATA=t,this.NODE=i):this.menuVisible2=!this.menuVisible2,document.addEventListener("click",function(e){s.menuVisible2=!1});var l=document.querySelector("#rightClickMenu2");l.style.left=e.clientX+30+"px",l.style.top=e.clientY+10+"px",l.style.position="fixed",l.style.width="160px"},dialogNewFormConfirm:function(){this.dialogNewFormVisible=!1,this.$message({type:"success",message:"新建成功!"})}})}),c=r,d=(i("efff"),i("2877")),u=Object(d["a"])(c,n,s,!1,null,"677cca52",null);t["default"]=u.exports},9523:function(e,t,i){},efff:function(e,t,i){"use strict";var n=i("9523"),s=i.n(n);s.a}}]);